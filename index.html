<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture Controlled Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            transition: background-color 0.5s, color 0.5s;
            line-height: 1.8;
            scroll-behavior: smooth;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 200vh; /* Make page long enough to scroll */
        }

        /* Light and Dark Mode Themes */
        .light-mode {
            background-color: #f4f4f4;
            color: #2c3e50;
        }

        .dark-mode {
            background-color: #2c3e50;
            color: #f4f4f4;
        }
        
        /* This container holds the button and notifications */
        .controls-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }

        /* Button to start the experience */
        #startButton {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: none; /* Hidden until model is loaded */
        }
         #startButton:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Notification Styling */
        #notification {
            padding: 12px 24px;
            background-color: #ffc107;
            color: #333;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Hide the video element completely by moving it off-screen */
        #webcam-container {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
    </style>
</head>
<body class="light-mode">

    <div class="controls-container">
        <div id="notification">Loading Model...</div>
        <button id="startButton" disabled>Enable Gesture Control</button>
    </div>

    <!-- The video element is necessary for the webcam feed, but it's hidden from view -->
    <div id="webcam-container">
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="container">
        <h1>An Normal Blog Post</h1>
        
        <br/>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh.</p>
        <p>Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam. Morbi pellentesque, mauris interdum porta tincidunt, neque orci molestie mauris, vitae iaculis dolor justo vitae magna. Quisque accumsan, quam eget consequat fermentum, lacus ligula venenatis sapien, ut commodo dui massa et metus. Proin vulputate, nunc vel cursus fermentum, nunc mi ultrices diam, at semper est nisi et ante. Fusce ac nulla ac nisi vulputate tincidunt. Suspendisse potenti. Nam pharetra, tortor eu iaculis rhoncus, purus magna congue justo, et iaculis eros libero et erat. In hac habitasse platea dictumst. Praesent sit amet quam. Fusce in enim et neque consequat cursus. Nunc mollis, orci ut semper mollis, lectus nulla varius turpis, non pulvinar urna est in orci. Nam pellentesque, massa in porta volutpat, velit sapien egestas augue, quis consectetuer neque leo et justo.</p>
 <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh.</p>
        <p>Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam. Morbi pellentesque, mauris interdum porta tincidunt, neque orci molestie mauris, vitae iaculis dolor justo vitae magna. Quisque accumsan, quam eget consequat fermentum, lacus ligula venenatis sapien, ut commodo dui massa et metus. Proin vulputate, nunc vel cursus fermentum, nunc mi ultrices diam, at semper est nisi et ante. Fusce ac nulla ac nisi vulputate tincidunt. Suspendisse potenti. Nam pharetra, tortor eu iaculis rhoncus, purus magna congue justo, et iaculis eros libero et erat. In hac habitasse platea dictumst. Praesent sit amet quam. Fusce in enim et neque consequat cursus. Nunc mollis, orci ut semper mollis, lectus nulla varius turpis, non pulvinar urna est in orci. Nam pellentesque, massa in porta volutpat, velit sapien egestas augue, quis consectetuer neque leo et justo.</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh.</p>
        <p>Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam. Morbi pellentesque, mauris interdum porta tincidunt, neque orci molestie mauris, vitae iaculis dolor justo vitae magna. Quisque accumsan, quam eget consequat fermentum, lacus ligula venenatis sapien, ut commodo dui massa et metus. Proin vulputate, nunc vel cursus fermentum, nunc mi ultrices diam, at semper est nisi et ante. Fusce ac nulla ac nisi vulputate tincidunt. Suspendisse potenti. Nam pharetra, tortor eu iaculis rhoncus, purus magna congue justo, et iaculis eros libero et erat. In hac habitasse platea dictumst. Praesent sit amet quam. Fusce in enim et neque consequat cursus. Nunc mollis, orci ut semper mollis, lectus nulla varius turpis, non pulvinar urna est in orci. Nam pellentesque, massa in porta volutpat, velit sapien egestas augue, quis consectetuer neque leo et justo.</p>

    
    </div>

    <script type="module">
        import { GestureRecognizer, FilesetResolver } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest";

        const video = document.getElementById("webcam");
        const notification = document.getElementById("notification");
        const startButton = document.getElementById("startButton");

        let gestureRecognizer;
        let lastGesture = "";
        let enableWebcamButton;

        // Function to update the notification text and manage its visibility
        function showNotification(text, duration = 2000) {
            notification.textContent = text;
            notification.style.opacity = 1;
            if(duration > 0) {
                setTimeout(() => {
                    notification.style.opacity = 0;
                }, duration);
            }
        }
        
        showNotification("Loading Model...", -1); // Show loading message indefinitely

        // --- 1. Initialize the Gesture Recognizer ---
        async function createGestureRecognizer() {
            const vision = await FilesetResolver.forVisionTasks(
                "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"
            );
            gestureRecognizer = await GestureRecognizer.createFromOptions(vision, {
                baseOptions: {
                    modelAssetPath: "https://storage.googleapis.com/mediapipe-models/gesture_recognizer/gesture_recognizer/float16/1/gesture_recognizer.task",
                    delegate: "GPU"
                },
                runningMode: "VIDEO",
                numHands: 1
            });
            console.log("Gesture recognizer loaded.");
            notification.style.opacity = 0; // Hide loading message
            startButton.disabled = false;
            startButton.style.display = 'block';
        }
        createGestureRecognizer();
        
        // --- 2. Add Click Event to the Button ---
        startButton.addEventListener("click", enableCam);

        function enableCam() {
             if (!gestureRecognizer) {
                alert("Gesture Recognizer is not ready yet!");
                return;
            }
            // Hide the button and show loading notification
            startButton.style.display = 'none';
            showNotification("Activating Webcam...", -1);

            // Get user media stream
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    video.srcObject = stream;
                    video.addEventListener("loadeddata", () => {
                        showNotification("✅ Ready for Gestures!");
                        predictWebcam();
                    });
                })
                .catch((err) => {
                    console.error("ERROR: " + err);
                    showNotification("❌ Webcam access denied.");
                });
        }
        
        // --- 3. Start the Prediction Loop ---
        let lastVideoTime = -1;
        async function predictWebcam() {
            if (video.currentTime !== lastVideoTime) {
                lastVideoTime = video.currentTime;
                const results = gestureRecognizer.recognizeForVideo(video, Date.now());

                if (results.gestures.length > 0) {
                    const currentGesture = results.gestures[0][0].categoryName;
                    
                    if (currentGesture !== lastGesture && currentGesture !== 'None') {
                        handleGesture(currentGesture);
                        lastGesture = currentGesture; // Update the last recognized gesture
                    }
                } else {
                    lastGesture = ""; // Reset if no hand is detected
                }
            }
            // Keep the loop running
            window.requestAnimationFrame(predictWebcam);
        }

        // --- 4. Handle the Detected Gestures ---
        function handleGesture(gesture) {
            let gestureText = "";
            switch (gesture) {
                case "Thumb_Down":
                    window.scrollBy(0, -300);
                    gestureText = "Scrolling Up ☝️";
                    break;
                case "Thumb_Up":
                    window.scrollBy(0, 300);
                    gestureText = "Scrolling Down 👍";
                    break;
                case "Open_Palm":
                    document.body.className = "light-mode";
                    gestureText = "Light Mode";
                    break;
                case "Closed_Fist":
                    document.body.className = "dark-mode";
                    gestureText = "Dark Mode";
                    break;
                default:
                    return; // Do nothing for other gestures like "None" or "Victory"
            }
            showNotification(gestureText);
        }
    </script>
</body>
</html>
